{% load static %}
<!DOCTYPE html>
<!--
这是一个入门模板页面。通过此页面从头开发新的项目。
该页面删除了所有链接，仅提供所需的标签。
-->
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AdminLTE 3 | 起始页</title>
    <style>
        @font-face {
            font-family: "Font Awesome 5 Brands";
            font-style: normal;
            font-weight: 400;
            font-display: block;
            src: url({% static 'fonts/fa-brands-400.eot' %});
            src: url({% static 'fonts/fa-brands-400.eot' %}?#iefix); format("embedded-opentype"),url({% static 'fonts/fa-brands-400.woff2' %}); format("woff2"),
        url({% static 'fonts/fa-brands-400.woff' %}); format("woff"),url({% static 'fonts/fa-brands-400.ttf' %}); format("truetype"),url( {% static 'fonts/fa-brands-400.svg' %}#fontawesome) format("svg")
        }

        .fab {
            font-family: "Font Awesome 5 Brands"
        }

        @font-face {
            font-family: "Font Awesome 5 Free";
            font-style: normal;
            font-weight: 400;
            font-display: block;
            src: url({% static 'fonts/fa-regular-400.eot' %});
            src: url({% static 'fonts/fa-regular-400.eot' %}?#iefix) format("embedded-opentype"), url({% static 'fonts/fa-regular-400.woff2' %}) format("woff2"), url({% static 'fonts/fa-regular-400.woff' %}) format("woff"), url({% static 'fonts/fa-regular-400.ttf' %}) format("truetype"), url({% static 'fonts/fa-regular-400.svg' %}#fontawesome) format("svg")
        }

        .fab, .far {
            font-weight: 400
        }

        @font-face {
            font-family: "Font Awesome 5 Free";
            font-style: normal;
            font-weight: 900;
            font-display: block;
            src: url({% static 'fonts/fa-solid-900.eot' %});
            src: url({% static 'fonts/fa-solid-900.eot' %}?#iefix) format("embedded-opentype"), url({% static 'fonts/fa-solid-900.woff2' %}) format("woff2"), url({% static 'fonts/fa-solid-900.woff' %}) format("woff"), url({% static 'fonts/fa-solid-900.ttf' %}) format("truetype"), url({% static 'fonts/fa-solid-900.svg' %}fontawesome) format("svg")
        }

        .fa, .far, .fas {
            font-family: "Font Awesome 5 Free"
        }

        .fa, .fas {
            font-weight: 900
        }
        .mytextarea{
            height:820px;
        }
    </style>
    <!-- 离线 Google 字体: Source Sans Pro -->

    <!-- Font Awesome 图标 -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/all.min.css' %}">
    <!-- 主题样式 -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/adminlte.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/dataTables.bootstrap4.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/jquery-ui.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/sweetalert2.min.css' %}">
    <script src="{% static 'javascript/echarts.min.js' %}"></script>

</head>
<body class="hold-transition sidebar-mini">

<!-- 模态框（Modal） -->


    <!-- 导航栏 -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
        <!-- 左侧导航栏链接 -->
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
            </li>

        </ul>

        <!-- 右侧导航栏链接 -->
        <ul class="navbar-nav ml-auto">
            <!-- Navbar Search -->
            <li class="nav-item">
                <a class="nav-link" data-widget="navbar-search" href="#" role="button">
                    <i class="fas fa-search"></i>
                </a>
            </li>

    </nav>
    <!-- /.navbar -->

    <!-- 主侧边栏容器 -->
    <aside class="main-sidebar sidebar-dark-primary elevation-4">

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- 侧边栏用户面板（可选） -->
            <div class="user-panel mt-3 pb-3 mb-3 d-flex">

                <div class="info">
                    <a href="#" class="d-block">后台管理</a>
                </div>
            </div>


            <!-- 侧边栏菜单 -->
            <nav class="mt-2">
                <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu"
                    data-accordion="false">
                    <!-- 使用 .nav-icon 类添加图标，
                         或使用 font-awesome 或其他任何图标字体库 -->
                    <li class="nav nav-tabs nav-item menu-open" id="">
                        <a href="#" class="nav-link active ">
                            <i class="nav-icon fas fa-tachometer-alt"></i>
                            <p>
                                主机
                                <i class="right fas fa-angle-left"></i>
                            </p>
                        </a>
                        <ul class="nav nav-treeview">
                            <li class="nav-item" onclick="$('#clickeventhost').toggle();">
                                <a href="#" class="nav-link" >
                                    <i class="far fa-circle nav-icon"></i>
                                    <p>主机管理</p>
                                </a>
                            </li>
                            <li class="nav-item" onclick="$('#clickeventuser').toggle();">
                                <a href="#" class="nav-link" data-toggle="tab">
                                    <i class="far fa-circle nav-icon"></i>
                                    <p>用户管理</p>
                                </a>
                            </li>

                            <li class="nav-item" onclick="$('#clickeventremote').toggle();">
                                <a href="#" class="nav-link" data-toggle="tab">
                                    <i class="far fa-circle nav-icon"></i>
                                    <p>远程命令</p>
                                </a>
                            </li>
                        </ul>
                    </li>

                </ul>
            </nav>
            <!-- /.sidebar-menu -->
        </div>
        <!-- /.sidebar -->
    </aside>

    <!-- Content Wrapper. 包含页面内容 -->
    <div class="content-wrapper">
        <!-- 内容标题（页面标题） -->
        <div class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">

                </div><!-- /.row -->
            </div><!-- /.container-fluid -->
        </div>



        <div class="container-lg">
            <!--主机管理 -->
            <div id="clickeventhost" style="display:none">
            <!--第一个echars -->


                <div class="container-lg">
                    <div class='container'>
                        <div class='row'>
                            <div class="col-lg-3 col-6">
                                <!-- small box -->
                                <div class="small-box bg-warning">
                                    <div class="inner">
                                        <h3>44</h3>
                                        <p>Root数量</p>
                                    </div>
                                    <div class="icon">
                                        <i class="fa fa-address-card"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-3 col-6">
                                <!-- small box -->
                                <div class="small-box bg-info">
                                    <div class="inner">
                                        <h3>44</h3>
                                        <p>user数量</p>
                                    </div>
                                    <div class="icon">
                                        <i class="fa fa-address-card"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-3 col-6">
                                <!-- small box -->
                                <div class="small-box bg-success">
                                    <div class="inner">
                                        <h3>44</h3>
                                        <p>在线主机</p>
                                    </div>
                                    <div class="icon">
                                        <i class="fa fa-desktop"></i>
                                    </div>
                                </div>
                            </div>


                        </div>
                    </div>
                    <div class="row">
                    <div class=col-sm-2>
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#hostmodel">添加主机</button>
                    </div>
                    <div class=col-sm-2>
                    <div class="dropdown">
                    <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        删除主机
                    </button>
                    
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    {% for i in data.items %}
                        <a class="dropdown-item deletehostipbutton">{{ i.1.1 }}</a>
                    {% endfor %}
                    </div>
                    </div>
                    </div>
                    </div>
                {% for i in data.items %}
                    <div class="row">
                        <div class="col-12">
                            <div class="row mt-5">
                                <div class="col ">
                                    <div class="card text-center">
                                        <div class="card-header">{{ i.1.1 }}  <!--这里是主机ip -->
                                            <div class="card-tools">
                                                <div class="text-right">
                                                    <button type="button" class="btn btn-tool pull-right"
                                                            data-card-widget="collapse">
                                                        <i class="fas fa-plus"></i>
                                                    </button>
                                                </div>
                                            </div>
                         
                                        </div>
                                        <div class="card-body" style="display: none">
                                            <!--这里是监控主机的图表 -->
                                            <div class="row">
                                                <div class="col-lg-3">
                                                    <div class="text-left">
                                                        <i class="fa fa-user" aria-hidden="true">username: {{ i.1.2 }}</i><br>
                                                        <i class="fa fa-lock" aria-hidden="true">Password: {{ i.1.3 }}</i><br>
                                                        <i class="fa fa-window-maximize" aria-hidden="true">Port: {{ i.1.4 }}</i><br>
                                                    </div>
                                                </div>
                                                <div class="col-lg-3">
                                                        <span><p>系统版本: {{ i.1.13 }}</p></span>
                                                        <span><p>系统CPU核数: {{ i.1.10 }}</p></span>
                                                        <span><p>系统内存总数: {{ i.1.11 }}</p></span>
                                                        <span><p>系统硬盘总数: {{ i.1.12 }}</p></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                 {% endfor %}
            </div>
            </div>

        </div>

        <!--远程管理 -->
        <div class="content" id="clickeventremote" style="display: none">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-12">
                        <!--placeholder 换行&#13;&#10; -->
                        <textarea type="text" id="motetextarea1" class="col-lg-12" rows="5"
                                  placeholder="1:点击发送一个只会发第一个IP&#13;&#10;2:点击发送一个后必点发送剩下&#13;&#10;3:点击发送全部是所有"></textarea>
                        <div class="row">
                            <div class="col-sm-1">
                                <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                                    商家
                                </button>
                                {% for x in data.items %}
                                    <ul class="dropdown-menu">
                                        <li><a href="#" class="dropdown-item clickeventcommandMerchant">{{ x.1.5 }}</a>
                                        </li>
                                    </ul>
                                {% endfor %}
                            </div>
                            <div class="col-sm-1">
                                <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                                    地区
                                </button>
                                {% for t in data.items %}
                                    <ul class="dropdown-menu">
                                        <li><a href="#" class="dropdown-item clickeventcommandArea">{{ t.1.7 }}</a></li>
                                    </ul>
                                {% endfor %}
                                </ul>
                            </div>
                            <div class="col-sm-1">
                                <button type="button" class="btn btn-primary" id="sendone">发送一个</button>
                            </div>
                            <div class="col-sm-1">
                                <button type="button" class="btn btn-primary" id="sendremain">发送剩下</button>
                            </div>
                            <div class="col-sm-1">
                                <button type="button" class="btn btn-primary" id="sendall">发送全部</button>
                            </div>
                        </div>
                        <h5 class="page-header"></h5>
                                <div class="row" style:"height:500px" >
                                    <textarea id="sshcommand" class="col-lg-3 mytextarea" placeholder="ssh command"></textarea>
                                    <div style="float:left;width: 10px;height: 820px; background: #FFB6C1;"></div> 
                                    <textarea class="col-lg-8 mytextarea" readonly="readonly" id="inputstdit"></textarea>
                                
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--用户管理 -->
        <div class="container-fluid">
            <div class="content" id="clickeventuser" style="display: none">
                <div class="row">
                    <div class="col-12">
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">添加用户</button>
                        <table id="useradmintable" class="display table table-striped table-bordered dt-responsive nowrap table-hover" style="width:100%; font-size: 10px">
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

  <!-- user模态框 -->
  <div class="modal fade" id="myModal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
   
        <!-- 模态框头部 -->
        <div class="modal-header">
          <h4 class="modal-title">模态框头部</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
   
        <!-- 模态框主体 -->
          <div class="modal-body">
              <div class="input-group mb-3">
                  <input type="text" class="form-control" placeholder="用户" id="user">
              </div>
              <div class="input-group mb-3">
                  <input type="text" class="form-control" placeholder="邮箱" id="mail">
              </div>
              <div class="input-group mb-3">
                  <input type="text" class="form-control" placeholder="主机ip" id="hostip">
              </div>
              <div class="input-group mb-3">
                  <input type="text" class="form-control" placeholder="主机密码" id="hostpasswod">
              </div>
              <div class="input-group mb-3">
                  <input type="text" class="form-control" placeholder="登录级别填1或0，1是root,0是user" id="leval">
              </div>
              <div class="input-group mb-3">
                  <input type="text" class="form-control" placeholder="商家" id="Menchant" >
              </div>
              <div class="input-group mb-3">
                  <input type="text" class="form-control" placeholder="地区" id="area">
              </div>
          </div>

          <!-- 模态框底部 -->
        <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
        <button id="adduserbutton" type="button" class="btn btn-primary" data-dismiss="modal">提交</button>

        </div>
   
      </div>
    </div>
  </div>

  <div class="modal fade" id="hostmodel">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
   
        <!-- 模态框头部 -->
        <div class="modal-header">
          <h4 class="modal-title">添加主机</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
   
        <!-- 模态框主体 -->
          <div class="modal-body">
              <div class="input-group mb-3">
                  <input type="text" class="form-control" placeholder="用户" id="hostrootmodel">
              </div>
              <div class="input-group mb-3">
                  <input type="text" class="form-control" placeholder="主机密码" id="hostpasswodmodel">
              </div>
              <div class="input-group mb-3">
                  <input type="text" class="form-control" placeholder="主机ip" id="hostipmodel">
              </div>
              <div class="input-group mb-3">
                  <input type="text" class="form-control" placeholder="主机端口" id="hostportmodel">
              </div>
              <div class="input-group mb-3">
                  <input type="text" class="form-control" placeholder="商家" id="Menchantmodel" >
              </div>
              <div class="input-group mb-3">
                  <input type="text" class="form-control" placeholder="地区" id="areamodel">
              </div>
          </div>

          <!-- 模态框底部 -->
        <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
        <button id="addhostbutton" type="button" class="btn btn-primary" data-dismiss="modal">提交</button>
        </div>
      </div>
    </div>
  </div>
</div>




        <!-- 载入脚本 -->

<!-- jQuery -->
<script src="{% static 'javascript/jquery.min.js' %}"></script>
<!-- Bootstrap 4 -->
<script src="{% static 'javascript/bootstrap.bundle.min.js' %}"></script>
<!-- AdminLTE App -->
<script src="{% static 'javascript/adminlte.min.js' %}"></script>
<script src="{% static 'javascript/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'javascript/dataTables.bootstrap4.js' %}"></script>
<script src="{% static 'javascript/sweetalert2.min.js' %}"></script>



<script>
function toggler(divId) {
    $("#" + divId).toggle();
}

function RefreshTable(tableId, url) {

    $.getJSON(url, null, function (json) {
        let table = $(tableId).dataTable();
        let oSettings = table.fnSettings();
        table.fnClearTable(this);
        for (var i = 0; i < json.aaData.length; i++) {
            table.oApi._fnAddData(oSettings, json.aaData[i]);
        }
        oSettings.aiDisplay = oSettings.aiDisplayMaster.slice();
        table.fnDraw();
    });
}

$(document).ready(function () {
        $('#useradmintable').DataTable({
        renderer: "bootstrap",

        'ajax': 'http://127.0.0.1:8000/getmysqldata/', // json的url
        'columns': [
            {'data': 'id',"title": "id"},
            {'data': 'user',"title": "用户"},
            {'data': 'user_email',"title": "邮箱"},
            {'data': 'user_ip',"title": "IP"},
            {'data': 'user_passwd',"title": "密码"},
            {'data': 'user_level',"title": "登录级别"},
            {'data': 'Merchant',"title": "商家"},
            {'data': 'Area',"title": "地区"},      
            {'data': 'status',"title": "状态"},
            {'data': 'null',"title": "编辑组"},
        ],
        'language': {
            'url': 'http://cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Chinese.json' // 以中文显示
        },
                    columnDefs:[{
                targets: 9,
                render: function (data, type, row, meta) {
                    return '<a type="button" class="col-xs-3 btn btn-danger btn-block" href="#" onclick=delFromID(' + row.id + ') >删除</a>';
                }
            },
                { "orderable": false, "targets": 9 },
            ],
    })
})

function refsh(){
    let refer = $('#useradmintable').DataTable();
    refer.ajax.reload();
}

function popups(text){
    const Toast = Swal.mixin({
  toast: true,
  position: 'top-end',
  showConfirmButton: false,
  timer: 1000,
  timerProgressBar: true,
  didOpen: (toast) => {
    toast.addEventListener('mouseenter', Swal.stopTimer)
    toast.addEventListener('mouseleave', Swal.resumeTimer)
  }
})

Toast.fire({
  icon: 'success',
  title: text
})
}

function delFromID(trid) {
    console.log(trid)
    $.ajax({
        url: 'http://127.0.0.1:8000/deletemysqldate/',
        type: "POST",
        data: JSON.stringify(trid),
        dataType : "json",
        success:  function(data){
            if (data === 200){
                refsh();
                location.reload();
            }},
        })}

$(document).on("click", "#adduserbutton", function() {
    let user_user = $("#user").val();
    let user_usermail = $("#mail").val();
    let user_hostip = $("#hostip").val();
    let user_hostpasswod = $("#hostpasswod").val();
    let user_leval = $("#leval").val();
    let user_Menchant = $("#Menchant").val();
    let user_area = $("#area").val();
    if (user_user != '' && user_usermail != '' && user_hostip != '' && user_hostpasswod != '' && user_leval != '' && user_Menchant != '' && user_area != ''){
        $.ajax({
            url:'http://127.0.0.1:8000/addmysqldate/',
            type: "POST",
            data: JSON.stringify({
                'user':user_user,
                'user_email':user_usermail,
                'user_ip':user_hostip,
                'user_passwd':user_hostpasswod,
                'user_level':user_leval,
                'user_Merchant':user_Menchant,
                'user_area':user_area,
            }),
            success:  function(data){
            if (data['status_code'] === 200){
                refsh();
                popups("添加成功");
            }},
        })
    }else{
        console.log("空")
    }
});

$(document).on("click", "#addhostbutton", function() {
    let user_user = $("#hostrootmodel").val();
    let user_port = $("#hostportmodel").val();
    let user_hostip = $("#hostipmodel").val();
    let user_hostpasswod = $("#hostpasswodmodel").val();
    let user_Menchant = $("#Menchantmodel").val();
    let user_area = $("#areamodel").val();
    if (user_user != '' && user_hostip != '' && user_hostpasswod != '' && user_port != '' && user_Menchant != '' && user_area != ''){
        $.ajax({
            url:'http://127.0.0.1:8000/addhostdate/',
            type: "POST",
            data: JSON.stringify({
                'ssh_root':user_user,
                'ssg_hostport':user_port,
                'ssh_ip':user_hostip,
                'ssh_passwd':user_hostpasswod,
                'ssh_host_cloud_merchant':user_Menchant,
                'ssh_host_in_the_area':user_area,
            }),
            success:  function(data){
            if (data['status_code'] === 200){
                popups("添加成功");
            }},
        })
    }else{
        console.log("空")
    }
});


$(document).ready(function(){
  $("a.deletehostipbutton").click(function(){
        let aclickdata =$(this).text()
        $.ajax({
            url: 'http://127.0.0.1:8000/deletehostdate/',
            type: "POST",
            data:JSON.stringify({'index':aclickdata}),
        })
  })})


$(document).ready(function(){
  $("a.clickeventcommandMerchant").click(function(){
        let aclickdata =$(this).text()
        $.ajax({
            url: 'http://127.0.0.1:8000/findhostdate/',
            type: "POST",
            dataType:"json",
            data:JSON.stringify({'index':aclickdata}),
            success:function(data){
                let datalist = new Array();
                $.each(data, function(i, item) {
                    console.log(item.ip)
                    datalist.push(item.ip)
            })
            $("#motetextarea1").val(datalist)
        }})
  })})

$(document).ready(function(){
  $("a.clickeventcommandArea").click(function(){
        let aclickdata =$(this).text()
        $.ajax({
            url: 'http://127.0.0.1:8000/findhostdate/',
            type: "POST",
            dataType:"json",
            data:JSON.stringify({'index':aclickdata}),
            success:function(data){
                let datalist = new Array();
                $.each(data, function(i, item) {
                    console.log(item.ip)
                    datalist.push(item.ip)
                    
            })
                $("#motetextarea1").val(datalist)
        }})
  })})
  

$(document).on("click", "#sendone", function() {
    let commandtextarea = $("#sshcommand").val()
    let hostip = $("#motetextarea1").val()
    let n=hostip.split(',');;
    if (hostip.indexOf(",") != -1 ){
        hostip = n[0];
    } 
    console.log(n[0])
    $.ajax({
        url: 'http://127.0.0.1:8000/sendcommand/',
        type:"POST",
        data:JSON.stringify({
            'command':commandtextarea,
            'iphost':hostip,
            'statuscode':1,
        }),
        success:function(data){
            $("#inputstdit").val(data)
        }
        })
    })

$(document).on("click", "#sendremain", function() {
    let commandtextarea = $("#sshcommand").val()
    let hostip = $("#motetextarea1").val()
    $.ajax({
        url: 'http://127.0.0.1:8000/sendcommand/',
        type:"POST",
        data:JSON.stringify({
            'command':commandtextarea,
            'iphost':hostip,
            'statuscode':2,
        }),
        success:function(data){
            $("#inputstdit").val(data)
        }
        })
})

$(document).on("click", "#sendall", function() {
    let commandtextarea = $("#sshcommand").val()
    let hostip = $("#motetextarea1").val()
    $.ajax({
        url: 'http://127.0.0.1:8000/sendcommand/',
        type:"POST",
        data:JSON.stringify({
            'command':commandtextarea,
            'iphost':hostip,
            'statuscode':1,
        }),
        success:function(data){
            $("#inputstdit").val(data)
        }
        })
})

</script>
</body>
</html>
